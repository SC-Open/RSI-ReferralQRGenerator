<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <script src="js/qrcode.min.js"></script>
</head>
<body>
    <div id="appArea">
        <h1>RSI Referral QR Code Generator</h1>
        <input type="text" id="referralCode" placeholder="STAR-XXXX-XXXX">
        <button type="button" id="generateButton">Generate QR Code</button>        
        <div id="outputData">
            <div id="qrcode"></div>
        </div>
    </div>
    <footer id="footer">
        <button type="button" id="aboutButton">About</button>
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h1>Like what we're doing? </h1><p>Here are some ways you can show your appreciation</p>
                <div class="box"><div class="content">
                    <a href="https://bit.ly/3TP4yKD" target="_blank" rel="noopener">
                    <button name="GitHub Sponsor"  type="button">Support on GitHub</button></a></div>
                </div>
                <div class="box"><div class="content">
                    <a href="https://bit.ly/SCOpenDevPatreon" target="_blank" rel="noopener">
                    <button name="Patreon Sponsor"  type="button">Support on Patreon</button></a></div>
                </div>
                <div class="box"><div class="content">
                    <a href="https://bit.ly/SCBonus5K" target="_blank" rel="noopener">
                    <button name="RSI Referral"  type="button">Enlist on RSI</button></a></div>
                </div>
            </div>
        </div>
        <p id="disclaimer">This is an unofficial Star Citizen fansite, not affiliated with the Cloud Imperium group of companies. All content on this site not authored by its host or users are property of their respective owners.</p>
    </footer>
    <script>
        document.getElementById('generateButton').addEventListener('click', generateQR);
        referallBase = 'https://robertsspaceindustries.com/?referral=';

        function generateQR() {
            let input = document.getElementById('referralCode').value;
            let match = input.match(/STAR-\w{4}-\w{4}/i);
            if (match) {
                let data = match[0];
                let url = referallBase + data;
                let qrcode = new QRCode(document.getElementById("qrcode"), {
                    text: url,
                    width: 128,
                    height: 128
                });
                // Reveal the #outputData element
                document.getElementById('outputData').style.display = 'block';
            } else {
                // Create a new notification element
                let notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = 'Invalid input. Please enter a referral code in the format STAR-XXXX-XXXX.';
                
                // Add the notification to the DOM
                document.body.appendChild(notification);
                
                // Remove the notification after 5 seconds
                setTimeout(function() {
                    document.body.removeChild(notification);
                }, 5000);
            }
        }
        document.getElementById('aboutButton').addEventListener('click', function() {
            openModal();
        });
        function openModal() {
            console.log('openModal');
            var modal = document.getElementById("myModal");
            var span = document.getElementsByClassName("close")[0];
            modal.style.display = "block";
            span.addEventListener('click', function() {
                closeModal(modal);
            });
            window.addEventListener('click', function(event) {
                closeOnOutsideClick(event, modal);
            });
        }
        function closeModal(modal) {
            modal.style.display = "none";
        }
        function closeOnOutsideClick(event, modal) {
            if (event.target == modal) {
                event.stopPropagation();
                modal.style.display = "none";
            }
        }
    </script>

</body>
</html>